#!/bin/bash

if [ "$1" == "" ]
then
  echo "You forgot an IP address!"
  echo "Syntax: ./ipscan.sh 192.168.ip"

else
  ip=$1
  # Create IP directory if it does not yet exist
  if [ ! -d "$ip" ]
  then
    mkdir "$ip"
  fi

  cd "$ip" || exit

  # Output header and conduct nmap scan
  echo -e "\033[31;1;4mSCAN FOR IP: $ip\033[0m\n" | tee "ipscan.txt"
  nmap -p- -A -T4 "$ip" -sV | tee -a "ipscan.txt"

  # Identify lines where "http" is mentioned on the port & capture the port number
  ports=$(grep " http " < "ipscan.txt" | awk '{print $ip}' | cut -d "/" -f 1)
  for port in $ports; do
    # Conduct ffuf fuzz
    echo -e "\n\033[31;1;4mFFUF Scan of port: $port\033[0m" | tee -a "ipscan.txt"
    ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u "http://$ip:$port/FUZZ" | tee -a "ipscan.txt"

    # Conduct dirb fuzz
    echo -e "\n\033[31;1;4mDirb Scan of port: $port\033[0m" | tee -a "ipscan.txt"
    dirb "http://$ip:$port" | tee -a "ipscan.txt"
    done
fi
