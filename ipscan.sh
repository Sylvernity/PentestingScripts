if [ "$1" == "" ]
then
  echo "You forgot an IP address!"
  echo "Syntax: ./ipscan.sh 192.168.1"

else
  # 1. Run nmap scan on $IP > nmapscan-$IP.txt
  mkdir "ipscan-$1"
  cd "ipscan-$1" || exit
  nmap -p- -A -T4 "$1" -sV > "nmapscan-$1.txt"
  echo -e "\033[31;1;4mSCAN FOR IP: $1\033[0m" > "ipscan-$1.txt"
  cat "nmapscan-$1.txt" >> "ipscan-$1.txt"

  # 2. Identify lines where "http" is mentioned on the port & capture the port number
  ports=$(grep " http " < nmapscan-192.168.23.130.txt | awk '{print $1}' | cut -d "/" -f 1)
  for port in $ports; do
    # 3. Conduct an ffuf fuzzing scan on the port
    ffuf -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt:FUZZ -u "http://$1:$port/FUZZ" > "ffufscan-$1-$port.txt"
    # shellcheck disable=SC2129
    printf "\n" >> "ipscan-$1.txt"
    echo -e "\033[31;1;4mFFUF Scan of port: $port\033[0m" >> "ipscan-$1.txt"
    cat "ffufscan-$1-$port.txt" >> "ipscan-$1.txt"

    # 4. Conduct a dirb fuzzing scan on the port
    dirb "http://$1:$port" > "dirbscan-$1-$port.txt"
    printf "\n" >> "ipscan-$1.txt"
    echo -e "\033[31;1;4mDirb Scan of port: $port\033[0m" >> "ipscan-$1.txt"
    cat "dirbscan-$1-$port.txt" >> "ipscan-$1.txt"
    done
fi
